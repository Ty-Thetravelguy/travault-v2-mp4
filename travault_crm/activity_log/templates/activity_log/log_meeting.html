{% extends "base.html" %}
{% load static %}
{% load custom_log_tags %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'activity_log/css/activity_style.css' %}">
{% endblock %}

{% block content %}
<section id="log-meeting" class="bg-gray-200">
    <div class="container top-padding roboto">
        <div class="row justify-content-center py-5">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-body">
                        <h2 class="card-title text-center mb-4">Log Meeting for {{ company.company_name }}</h2>
                        <form method="post" action="#" id="logMeetingForm">
                            {% csrf_token %}

                            <!-- Subject -->
                            <div class="mb-3">
                                <label for="{{ form.subject.id_for_label }}" class="form-label">Subject</label>
                                {{ form.subject|add_class:"form-control" }}
                            </div>

                            <!-- Attendees -->
                            <div class="mb-3">
                                <label for="id_attendees_input_display" class="form-label">Attendees</label>
                                <input type="hidden" id="id_attendees_input" name="attendees_input" value="">
                                <div id="selected-attendees" class="selected-companies mt-2"></div>
                                <input type="text" id="id_attendees_input_display" class="form-control">
                                <div class="form-text text-muted">Select contacts from company and agency staff members.
                                </div>
                            </div>

                            <!-- Outcome and Location (same line) -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.outcome.id_for_label }}" class="form-label">Outcome</label>
                                    {{ form.outcome|add_class:"form-select" }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.location.id_for_label }}" class="form-label">Location</label>
                                    {{ form.location|add_class:"form-select" }}
                                </div>
                            </div>

                            <!-- Date, Time, and Duration (same line) -->
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.date.id_for_label }}" class="form-label">Date</label>
                                    {{ form.date|add_class:"form-control" }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.time.id_for_label }}" class="form-label">Time</label>
                                    {{ form.time|add_class:"form-control" }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.duration.id_for_label }}" class="form-label">Duration</label>
                                    {{ form.duration|add_class:"form-select" }}
                                </div>
                            </div>

                            <!-- Details -->
                            <div class="mb-3">
                                <label for="{{ form.details.id_for_label }}" class="form-label">Details</label>
                                {{ form.details|add_class:"form-control" }}
                            </div>

                            <!-- To Do Task / Follow-up -->
                            <div class="mb-3">
                                <label for="{{ form.to_do_task_date.id_for_label }}" class="form-label">To Do Task /
                                    Follow-up</label>
                                {{ form.to_do_task_date|add_class:"form-control" }}
                            </div>

                            <!-- Save Meeting Button -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-get-started btn-lg" id="submitButton">Save
                                    Meeting</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}
{% block postload_js %}
<!-- Include CKEditor JS -->
<script src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js"></script>


<!-- Initialize CKEditor on the 'details' field -->
<script>
    ClassicEditor
        .create(document.querySelector('#id_details'), {
            toolbar: {
                items: [
                    'heading', '|',
                    'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote', '|',
                    'undo', 'redo'
                ]
            },
            // Configure the height more robustly
            ui: {
                viewportOffset: {
                    top: 30
                } // Optional: Offset for better UI control if needed
            }
        })
        .then(editor => {
            // Apply the min-height using both methods to ensure stability
            editor.ui.view.editable.element.style.minHeight = '300px'; // Set the height for the content area
            editor.editing.view.change(writer => {
                writer.setStyle('min-height', '300px', editor.editing.view.document.getRoot());
            });
        })
        .catch(error => {
            console.error(error);
        });
</script>

<!-- External JS file for log meeting form (with vanilla JS) -->
<script src="{% static 'activity_log/js/activity_log_script.js' %}"></script>
{% endblock %}